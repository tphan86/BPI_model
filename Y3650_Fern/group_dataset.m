% Specify the excel file name
excelFileName = 'dataset_Y3650F.xlsx';
sheetName = 'Y3650_Fern';

% Read the excel file using readcell to preserve original column names
raw_data = readcell(excelFileName, 'Sheet', sheetName);

% Extract headers (first row) and data (remaining rows)
headers = raw_data(1, :); % Extract headers from the first row
data = raw_data(2:end, :); % Extract data from the remaining rows
y3650_data = cell2table(data, 'VariableNames', headers); % Convert to table for easier manipulation

% Group data for Y3650_Fern
low_group_y3650_mean = mean([y3650_data.Control_1,...
                             y3650_data.Control_2,...
                             y3650_data.Control_3, ...
                             y3650_data.X9_1,...
                             y3650_data.X9_2,...
                             y3650_data.X9_3], 2);
low_group_y3650_std = std([y3650_data.Control_1,...
                           y3650_data.Control_2,...
                           y3650_data.Control_3, ...
                           y3650_data.X9_1,...
                           y3650_data.X9_2,...
                           y3650_data.X9_3], 0, 2);
low_group_y3650_std(low_group_y3650_std > low_group_y3650_mean) =...
    low_group_y3650_mean(low_group_y3650_std > low_group_y3650_mean);

medium_group_y3650_mean = mean([y3650_data.X8_1,...
                                y3650_data.X7_1,...
                                y3650_data.X7_2,...
                                y3650_data.X7_3], 2);
medium_group_y3650_std = std([y3650_data.X8_1,...
                              y3650_data.X7_1,...
                              y3650_data.X7_2,...
                              y3650_data.X7_3], 0, 2);
medium_group_y3650_std(medium_group_y3650_std > medium_group_y3650_mean) =...
    medium_group_y3650_mean(medium_group_y3650_std > medium_group_y3650_mean);

medium_high_group_y3650_mean = mean([y3650_data.X8_3,...
                                     y3650_data.X6_1,...
                                     y3650_data.X6_2,... 
                                     y3650_data.X6_3], 2);
medium_high_group_y3650_std = std([y3650_data.X8_3,...
                                   y3650_data.X6_1,...
                                   y3650_data.X6_2,...
                                   y3650_data.X6_3], 0, 2);
medium_high_group_y3650_std(medium_high_group_y3650_std > medium_high_group_y3650_mean) =...
    medium_high_group_y3650_mean(medium_high_group_y3650_std > medium_high_group_y3650_mean);

high_group_y3650_mean = mean([y3650_data.X5_1,...
                              y3650_data.X5_2,...
                              y3650_data.X5_3], 2);
high_group_y3650_std = std([y3650_data.X5_1,...
                            y3650_data.X5_2,...
                            y3650_data.X5_3], 0, 2);
high_group_y3650_std(high_group_y3650_std > high_group_y3650_mean) =...
    high_group_y3650_mean(high_group_y3650_std > high_group_y3650_mean);

% Add grouped data to a new table for Y3650_Fern
y3650_grouped = table(y3650_data.Time, low_group_y3650_mean, low_group_y3650_std, ...
    medium_group_y3650_mean, medium_group_y3650_std, ...
    medium_high_group_y3650_mean, medium_high_group_y3650_std, ...
    high_group_y3650_mean, high_group_y3650_std, ...
    'VariableNames', {'Time', 'Low_Group_Mean', 'Low_Group_Std', ...
                      'Medium_Group_Mean', 'Medium_Group_Std', ...
                      'Medium_High_Group_Mean', 'Medium_High_Group_Std', ...
                      'High_Group_Mean', 'High_Group_Std'});

% Save the grouped data to new sheets in the same Excel file
writetable(y3650_grouped, filename, 'Sheet', 'Y3650_Fern_Grouped');

disp('Data has been grouped, adjusted, and saved successfully.');
